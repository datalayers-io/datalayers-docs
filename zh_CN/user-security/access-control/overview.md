# 访问控制概述

访问控制系统是数据库安全的核心，它决定了哪些用户可以连接到数据库以及他们被允许执行哪些操作。Datalayers 的访问控制系统主要围绕用户、权限、权限三个核心概念构建。

## 用户

用户是指连接到 Datalayers 数据库服务器的客户端。每个用户都由一个用户账户标识，用户账户由用户名和主机名构成，例如 `'user'@'localhost'` 表示用户名为 `user` 的用户从本机连接到服务器。通过这种用户名和主机名结合的方式，可以为从不同主机登录的用户设置不同的权限。

更多有关用户账户的信息请参照：[用户管理](./user.md)。

## 权限

权限定义了用户可以在数据库中执行的具体操作。Datalayers 提供了三种类型的权限：

- 全局权限：适用于服务器中所有对象的权限，以及与系统管理相关的权限，例如：在任意数据库中建表的权限，向集群中添加节点的权限等。

- 数据库权限：适用于指定的数据库及其包含的所有对象的权限。例如：在数据库中建表、删表的权限，访问数据库中某张表的权限等。

- 对象权限：适用于数据库中的特定对象的权限，当前 Datalayers 仅支持表级权限，例如：访问某张表的权限。

通过授予和撤销这些权限，数据库管理员可以精确控制用户对数据的访问和操作能力。

更多有关权限的信息请参照：[权限管理](./privilege.md)。

## 角色

角色是权限的集合，也可以将其视为一个没有直接登录能力的特殊用户。角色可以被授予一组预定义的权限，然后将该角色授予一个或多个用户。用户被授予角色后，只需在使用时激活这些角色就能获得相应的权限。

角色的主要作用在于将权限分组，从而简化权限管理，尤其是在用户众多、权限需求复杂的环境中。通过创建不同的角色来代表不同的职责或访问级别（例如，一个 'read_only' 角色只拥有查询权限，一个 'app_user' 角色拥有数据读写权限），数据库管理员可以避免为每个用户单独授予和撤销大量权限，只需将相应的角色授予用户即可。


更多有关角色的信息请参照：[角色管理](./role.md)。

## 访问控制流程

当一个用户尝试连接到 Datalayers 服务器并执行某个操作时，访问控制系统会进行以下检查：

1. 身份验证：检查客户端传递的用户名与主机名是否存在于系统中，以及对应的密码是否正确。若是则连接成功，否则拒绝该连接。

2. 请求验证：连接成功后，对于客户端发起的后续请求，系统会检查是否符合相应的权限要求，例如是否具有建表的权限。此过程是自上而下的，即按照全局权限、数据库权限、对象权限的顺序检查，只要在任何一个级别中具备相关权限，请求将被接受。
