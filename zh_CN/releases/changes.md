# CHANGELOG

## 2.3.17

发布日期: 2026-01-25

### 增强

- **支持 Float16 类型**，适配低精度数值场景，平衡存储成本与计算效率
- **创建向量索引时，支持更多索引配置项**：添加 IVF_PQ 索引的 num_cells、num_bits 等配置项，添加 HNSW 索引的 ef_construction、max_level、m 等配置项
- **支持向量检索时指定 nprobes、refine_factor 等查询参数，允许用户平衡召回率和性能**：用法示例 `select * from t where parameters('nprobes=4', 'refine_factor=2') order by l2_distance(embed, query) limit 1`
- **为向量索引支持 PQ4 量化算法**：PQ4 相比 PQ8，在牺牲一定查询精度的情况下，大幅降低了大规模向量存储成本。
- **支持使用 Postgres 风格的向量距离运算符**：`<->` 代表 l2_distance，`<#>` 代表 dot_distance，`<=>` 代表 cosine_distance。用法示例 `select * from t order by embed <-> query limit 1`
- **支持 PromQL 的 U_ 转义语法**，提升与监控场景下 PromQL 语句的兼容能力

### 优化

- 优化 append 模式查询性能：避免使用 MergeReader，大幅提升内存 + 磁盘混合查询场景的响应速度
- 优化 HNSW 索引检索逻辑：当 filter rate 较大时，自动回退到 flat search，保障检索召回率


## 2.3.16

发布日期: 2026-01-05

### 增强
- **VECTOR 数据类型增强**：现在在写入数据时，VECTOR 类型的字段支持存储 NULL 值。

### 修复
- 修复了在单机运行模式下，表名中包含下划线（_）字符时，在特定场景下系统未能正确处理的问题。


## 2.3.15

发布日期: 2025-12-18

### 新功能

- **PostgreSQL 协议兼容**：现支持 PostgreSQL 连接协议，用户可使用更广泛的第三方客户端、GUI 工具（如 DBeaver）和驱动程序连接至数据库，提升操作灵活性与集成便利性。
- **PRQL 查询支持**：dlsql 命令行工具已集成 [PRQL](https://prql-lang.org/) 查询语言，为用户提供更具表达力的现代化数据查询与转换体验。具体用法请参阅 [dlsql文档](../admin/datalayers-cli.md#交互语言)。
- **可视化 Web 控制台**：dlsql 命令行工具现已集成内置的 Web 控制台，提供数据库的可视化操作与管理界面，简化数据库管理任务。使用方法详见[dlsql文档](../admin/datalayers-cli.md#web-控制台)。
- **慢查询日志**：新增慢日志记录功能，帮助识别和优化执行效率较低的查询，以提升系统整体性能。使用方法详见[查询配置文档](../admin/configuration-fields/query.md)。

### 增强

- **Binary 数据类型**：新增对 Binary 数据类型的支持，便于直接存储和处理图像、文件等二进制数据。
- **递归 CTE**：在公共表表达式 ([CTE](../sql-reference/statements/cte.md)) 中现已支持递归查询，能够有效处理具有层次或树状结构的复杂数据。
- **密码强度配置**：支持自定义密码强度策略，增强系统安全性。使用方法详见[密码策略](../user-security/password-policy.md)。

### 优化

- **PromQL 查询优化**：显著提升了 PromQL 查询的执行性能与效率，使监控指标查询响应更快，资源消耗更低。

### 修复

- 修复在行协议写入模式下，高并发进行自动建表可能导致异常的问题。

## 2.3.14

发布日期: 2025-11-25

本版本重点增强了系统的 安全性、可观测性、查询性能与向量检索能力，并进一步完善了对 Prometheus 生态的兼容性，为用户提供更灵活、更安全、更高性能的数据管理体验。

### 新功能

- **RBAC 访问控制**：新增 [基于角色的访问控制](../user-security/rbac/overview.md) 功能，实现细粒度的权限控制。
- **Prometheus 增强**：支持 Prometheus Remote Write 协议，可通过该协议直接写入数据。现 Datalayers 已经完全兼容 Prometheus 写入与查询协议，可做为 Prometheus 的长期存储或者替换 Prometheus。
- **向量索引**：新增多种 [向量索引](../vector-search/vector-index.md) 类型的支持，提升检索效率与灵活性。
- **用户认证**：新增 peer认证 机制，详见 [peer认证](../admin/datalayers-cli.md)。
- **审计日志**：新增审计日志功能，增强操作可追溯性与安全性。

### ️优化

- **查询性能**：
  - 优化 count(*) 查询逻辑，显著提升包含时间范围过滤条件（如 WHERE ts > now() - INTERVAL 10 day）的查询效率。

## 2.3.13

发布日期: 2025-10-20

### 🚀 新功能

#### PromQL

- 实现 PromQL 主要函数，支持 Prometheus 查询协议

### 优化

- 优化 TIMESTAMP 数据类型校验逻辑
- 优化 last cache 逻辑，提升 last cache 效率
- 优化 sst file 过期文件清理逻辑，通过分批清理，降低后端压力
- 优化 compaction 逻辑，提升 compaction 的效率
- 优化 failover 逻辑，如果启动时节点处于 prepare 过程中，不触发 failover 逻辑

### 修复

- 修复了 PIVOT 函数在特殊情况（复杂 SQL）下可能出现栈溢出的问题

## 2.3.12

发布日期: 2025-09-24

### 🚀 新功能

#### LAST CACHE（时序引擎最新值缓存）

- **核心功能**：为时序引擎新增点位最新值缓存机制，显著提升最新数据查询速度
- **性能提升**：查询性能提升数十倍，特别适用于高频访问最新数据的场景（如实时监控大屏）

### ⚡ 性能提升

#### 查询优化

- 优化查询路径逻辑，在 **高并发场景下** 查询 QPS 提升 **10%+**

#### 内存优化

- 调整元数据缓存策略，降低服务运行内存占用

### 🔍 其它

- 提供更多维度的运行指标，便于实时观测系统健康状态
- 基础镜像从 **Ubuntu 22.04** 升级至 **Ubuntu 24.04**
- 调整日志格式，关键信息更清晰易读，便于快速定位问题
- 优化进程退出逻辑
- 关系引擎的基础框架代码合入

## 2.3.11

发布日期: 2025-09-08

### 新功能

- **Primary key​​**
  - 在时序引擎中，支持 `Primary Key` 语句,使用方式见[时序引擎](../sql-reference/table-engine/timeseries.md)介绍。
- **数据导入**
  - `dlsql` 支持导入指定的 SQL 脚本。

### 增强

- **内存管理​​**
  - 优化内存管理逻辑，加速内存回收，降低请求的尾延时。

## 2.3.10

发布日期: 2025-08-28

### 增强

- 集群模式下重启时刷新集群元数据（如：内存、CPU等）。
- 优化集群节点退出逻辑，节点退出时更加快速、平滑。
- 优化过期数据清理逻辑，加速脏数据回收，更快释放系统资源。

### 修复

- 修复了在 SQL 语句中包含某些特殊字符可能导致 SQL 注入的问题。
- 修复在 DBeaver 中通过 Insert 语句写入可能失败的问题。

## 2.3.9

发布日期: 2025-08-18

### 新功能

- **​SQL HINTS**
  - 新增对SQL Hints的支持，允许开发者在查询中嵌入优化器指令，以干预执行计划生成。
    - ​**​并行查询​**​：通过 parallel_degree 控制查询并行度（如：/*+ SET_VAR(parallel_degree=1)*/）

### 增强

- **优化查询逻辑​​**
  - 时序场景下，缓存 SST 文件列表，减少元数据加载开销，查询QPS提升5%。
- **写入逻辑优化​​**
  - 移除写入路径冗余的优化器调用，降低写入延迟，提升吞吐量。

### 其它

- 优化混合缓存逻辑。
- 优化启动逻辑，降低启动耗时。

## 2.3.8

发布日期: 2025-08-03

### 增强

- **​优化 COMPACT 逻辑​​**
  - 在完全乱序写入的情况下减少内存的占用。
- **优化集群备份、恢复逻辑​​**
  - Datalayers 支持 ctl 指令，方便在重建集群时，通过 reset 指令快速重置状态。

## 2.3.7

发布日期: 2025-07-28

### 增强

- **​支持强制删除节点​​**
  - 新增 force 指令，允许在特殊场景下强制删除节点，提升运维灵活性。
- **增强 S3 协议兼容性​​**
  - 新增对 S3 ​​virtual-hosted-style​​ 访问方式的支持，兼容更多对象存储服务。

### 修复

- 优化了 SQL 解析逻辑，确保在各类场景下对列名大小写的处理保持一致，避免因大小写差异导致查询异常。

## 2.3.6

发布日期: 2025-07-23

### 新功能

- **​向量检索**
  - 内置向量检索支持，增强非结构化数据查询能力，详见[向量检索文档](../vector-search/overview.md)
- **时序引擎增强**
  - 新增 `append` 格式支持，允许保留重复主键数据，详细使用参考[table options](../sql-reference/table-engine/timeseries.md)
- **协议兼容性**
  - MCP 协议适配至最新版本，确保与上下游系统的无缝集成

### 增强

- **数据导出改进**
  - 优化 dldump 逻辑，导出效率提升， 在导出大量数据时极大的降低了服务端的内存占用。
- **启动效率提升**
  - 改进索引加载逻辑，提升索引加载的有效性。

## 2.3.5

发布日期: 2025-07-07

### 增强

- 优化统计信息，提升部份场景聚合函数的性能。

## 2.3.4

发布日期: 2025-07-03

### 新功能

- **窗口函数支持**
  - 新增对标准窗口函数的支持，详情请参考[窗口函数文档](../sql-reference/statements/window-function.md)
- **流式窗口函数**
  - 扩展窗口函数能力至流式数据处理场景，详见[流式窗口函数文档](../sql-reference/streaming-window.md)  
- **PIVOT 操作**
  - 新增 PIVOT 数据透视功能，使用方法参考[PIVOT文档](../sql-reference/statements/pivot.md)
- **WITHIN GROUP 语法**
  - 支持有序集合聚合操作，详见[WITHIN GROUP文档](../sql-reference/statements/within-group.md)

### 增强

- **SQL 引擎重构**
  - 优化底层处理逻辑，为后续关系引擎集成奠定基础。
- **​​索引缓存优化​​**
  - 改进缓存管理机制，查询性能显著提升。

## 2.3.3

发布日期: 2025-06-05

### 增强

- **集群优化**  
  - ​简化高可用逻辑​​，增强集群稳定性与容错能力。  
  - 优化节点选举机制，减少脑裂风险，提升故障切换速度。  
- **可观察性增强**
  - 新增混合缓存监控指标​​。
  - ​丰富元数据缓存指标​​，便于监控缓存健康状态。  
- **核心函数优化**
​- ​优化 last_value 函数​​，提升大数据集查询性能。
- **缓存管理优化**
  - ​禁止后台任务自动刷新缓存​​，减少不必要的缓存更新，提高缓存利用率。
  - 降低系统开销，提升整体性能。
- **集群节点信息查询**
  - ​新增 SHOW CURRENT NODE 指令​​，在集群模式下可直接查看当前连接的节点信息。
- **内存优化**
  - 优化内存管理策略，大幅减少内存占用。

## 2.3.2

发布日期: 2025-05-19

### 修复

- 修复 插值函数 在某些场景下可能失败的问题，该问题在 v2.3.1 中引入。

## 2.3.1

发布日期: 2025-05-15

### 新功能

- 新增 `json` 处理函数，提供便捷的 `JSON` 字符串解析与处理，详见[JSON 函数](../sql-reference/json.md)。
- **dlsql 命令行工具增强**
  - 支持关键字高亮显示与智能自动补全，提升编写效率。
  - 支持单次输入多条 SQL 语句，简化批量操作流程。

### 增强

- **资源优化**
  - 限制查询对系统内存的占用，提升系统健壮性。
- **时序引擎优化**
  - 当启用存储引擎元数据缓存时，数据持久化阶段自动缓存 meta 信息，提升热数据查询性能。
- **集群模式优化**
  - 下推更多算子至数据节点，减少集群内数据传输量，提升查询性能。
  - `EXPLAIN [analyze] [verbose] SELECT select_options` 语句的支持，便于分析集群模式下查询执行计划、分析性能瓶颈，优化 SQL 语句。

### 其它

- 优化集群间通讯逻辑。

## 2.3.0

发布日期: 2025-04-14

### 增强

- **并行查询优化**：引入 MPP（大规模并行处理）查询引擎，通过跨节点分布式计算加速查询执行。
- **集群通信优化**：重构节点间通信协议，显著提升集群元数据的一致性与可靠性。
- **混合缓存优化**：实现分布式混合缓存架构，极大提升缓存利率用、提升查询性能，同时支持缓存资源的水平扩展。
- **​性能提升**：提升查询性能，根据场景有 10%-300% 的性能提升。

### 破坏性变更⚠️

本次升级包含存储引擎与元数据结构的重大优化，​​不兼容​​ 2.2.x 版本直接升级。
如需跨版本升级，请联系技术支持团队获取迁移方案。

## 2.2.16

发布日期: 2025-04-02

### 增强

- **缓存优化**：​优化数据缓存逻辑，提升缓存资源的利率用。
- **集群通信改进**：优化集群间 gRPC 通讯协议，降低通讯时延。
- **元数据管理**：优化元数据失效策略，修复跨节点元数据不一致问题。
- **​SQL引擎增强**：在 SQL 子查询中，子查询支持时间戳自动转换。

## 2.2.15

发布日期: 2025-03-25

### 新功能

- **​原生 MCP 服务器支持**：通过 Server-Sent Events (SSE) 方式，实现了与大模型的快速集成，提升系统扩展性和灵活性。

### 增强

- ​**集群通讯优化**：重构了集群间的通讯逻辑，显著提升了通讯的稳定性和可靠性。
​- **时间索引优化**：优化了时间索引机制，大幅提升了查询效率，提升了整体系统性能。

## 2.2.14

发布日期: 2025-03-17

### 增强

- ​新增 rebalance 指令。支持在集群内 partitions 分布不均衡时，通过该指令快速实现重平衡，确保资源分配更加合理。
- SQL 函数性能优化。对部分 SQL 函数进行深度优化，查询性能提升 10%～100%，显著提升查询效率。
- 元数据 Cache 功能优化。优化元数据 Cache 机制，提升 Cache 命中率和效率，进一步加快元数据访问速度，提升整体性能。

## 2.2.13

发布日期: 2025-03-05

### 增强

- 新增 `auto_failover` 配置项。支持通过该配置项控制故障时是否启用自动迁移功能，提升集群容错能力。
- 集群内部通讯支持压缩。优化集群节点间通信性能，启用压缩功能以减少网络传输开销，提升整体效率。

## 2.2.12

发布日期: 2025-02-22

### 增强

- 新增线性插值、前序有效值填充（Last Valid Value）及自定义值补全等多种插值策略，支持对时序数据缺失值的动态智能修复。通过灵活配置，用户可精准控制缺失值的填补逻辑，保障数据连续性与业务分析的准确性。（详见 [gap_fill 插值算法文档](../sql-reference/gap_fill.md)）。
- key-value 存储兼容 Redis AUTH 认证机制与 SELECT 命令语法，实现与 Redis 生态工具的无缝对接。
- 优化混合缓存逻辑，显著降低查询延迟。
- 新增 EXCLUDE NODE 和 INCLUDE NODE 命令，支持管理员实时排除故障节点或动态纳入新节点，提升运维效率。

## 2.2.11

发布日期: 2025-01-15

### 增强

- 实现 metrics-exporter，通过标准化接口输出关键指标（如缓存命中率、集群状态），彻底消除对第三方监控组件的依赖，简化部署流程并降低运维学习成本。
- 优化 [COMPACT](../sql-reference/statements/compact.md) 命令逻辑，新增 FROM 和 TO 选项，支持按需指定压缩时间窗口。

## 2.2.10

发布日期: 2025-01-09

### 新功能

- 数据落盘时支持速度控制，通过配置参数动态限制数据落盘的带宽占用，实现消峰填谷，让系统运行更加平顺。
- INSERT 支持标量函数，允许在插入值时直接调用内置标量函数，如：NOW()。

## 2.2.9

发布日期: 2024-12-31

### 增强

- 冷启动优化，在系统启动时支持异步加载系统元数据以及索引信息，加载后首次查询性能可提升数十倍。
- 优化了存储的配置项，简化配置逻辑。
- 在日志中，对于一些关键行为（如：删除、compact等），将日志级别调整为 `info`。

## 2.2.8

发布日期: 2024-12-23

### 增强

- 支持按列配置数据的编码方式以及压缩算法，用户可根据数据特性灵活优化存储成本与查询效率。
- 动态表重命名支持，支持通过 `ALTER TABLE` 语句修改表名。
- 支持 `datalayers -v` 命令，实时打印加载的配置项树形结构，便于快速定位配置冲突。
- 在配置文件中设置 S3、Azure 等对存储后，可通过全局配置文件中的 `default_storage_type` 指定默认的存储服务。
- 单机模式下支持配置缓存，以加速查询（如：当在单机模式下，存储使用S3 等对象存储，可通过开启混合缓存实现查询加速）。
- 优化 SQL 错误信息，在异常情况下错误信息将更加精准。
- 优化 dldump 工具，提升导出、导入效率。
- 优化 Flight SQL 协议，提升 DBeaver 兼容性。
- 优化 `show create table` 语句。
- 在建表时，增加对 `timestamp key` `与 partition key` 的检查，不允许设置为 NULL。

### 修复

- 在执行 `drop table` 时，元数据缓存未被彻底清除的问题。

## 2.2.7

发布日期: 2024-12-12

### 增强

- 行协议写入时，增加对 tag 的检查，不符合规则的会被拒绝。
- 在 Flight SQL 协议中增加返回服务端的 Version。
- 在 `show create table` 语句中显示 comment 内容。

## 2.2.6

发布日期: 2024-12-10

### 增强

- table options 中的配置支持热更新（如：TTL、MEMTABLE_SIZE 等），无需重启服务即可生效。。
- 支持 `truncate table` ，提供快速清空表数据的轻量级操作。
- 优化 cache 更新逻辑，提升性能。

### 修复

- 修复原有不敏感匹配问题，现字段名称区分大小写。

## 2.2.5

发布日期: 2024-12-01

### 增强

- 新增 SHOW TASK 命令，集中展示集群节点状态、任务进度及资源占用信息，便于运维人员快速定位瓶颈。
- 在 information_schema 中新增 TASKS 和 COLUMNS.comments 视图，支持通过 SQL 查询任务详情和字段注释，满足审计与文档自动化需求。
- 新增 SELECT VERSION() 语句，一键获取数据库节点及集群版本信息，简化环境排查流程。
- 在查询中支持使用 UNIX 时间戳进行比较，如 `time >= 1672531200`。
- 在建表时，支持对字段添加 comment。
- 完善 JDBC 协议，提升生态兼容性兼容性。

### 修复

- 认证鉴权可能失败的问题。

### Breaking changes

- 通过 INTERVAL 对时间进行计算时，INTERVAL 后面的语句不再使用 "`" 进行包裹。

## 2.2.4

发布日期: 2024-11-11

### 新功能

- 新增对 DBeaver 的原生集成支持，提供 SQL 编辑、数据可视化、元数据查询等功能。详见[DBeaver 配置](../integration/datalayers-with-dbeaver.md)。
- 支持通过 compact 指令对数据进行整理。

### 增强

- 现已默认启用 compaction，无须再通过手动开启。
- 使用 InfluxDB 行协议写入时忽略 Tag 字段的顺序，消除因字段书写顺序不一致导致的写入失败问题。
- `explain analyze` 语句支持更多的指标。
- 查询性能优化。

## 2.2.3

发布日期: 2024-10-29

### 增强

- 优化集群间通信逻辑，提升查询效率。
- 增加更多的 Metrics，提升系统的可观察性。
- 提升数据查询效率。
- 实现更多的 Flight SQL 接口。

## 2.2.2

发布日期: 2024-10-21

### 增强

- 对于补录的数据，优化了查询逻辑，提升查询效率。
- 使用 to_unixtime 函数时，支持对时区的处理。

### 修复

- dlsql 可能 panic 的问题。
- 在部份场景下，datalayers 平滑退出耗时较长的问题。
- 查询数据结果中存在补录数据时，部份查询场景可能报错的问题。

### 其他

- 表名支持 `-` 连接符（如表名中带`-`， 在执行相关 SQL 语句时，需使用 "`" 将对应的字符串进行包裹）。
- 丰富 Hybrid cache 的 metrics，以更方便的观察 Hybrid cache 的使用情况。
- 优化 dlsql 的错误处理处理，当 SQL 语句报错时可更清晰的展示相关错误信息。

## 2.2.1

发布日期: 2024-10-09

### 新功能

- 在时序引擎中，支持数据补录。

### 增强

- 使用 `dldump` 工具进行备份与还原时，添加了进度条。
- 系统重启时，将根据 CPU Core 数量，对于 `wal` 进行并性重放，以加速系统启动。
- 使用 InfluxDB 行协议写入，所有 `tag` 做为 partition key。
- 缓存更多数据的统计信息，以加速查询。

### 修复

- 当 partition key 为多列时，修复分区信息计算可能不正确的问题。

### 其他

- 对表 column 的数量限制。

## 2.1.11

发布日期: 2024-09-23

### 增强

- 重构了`meta cache`，使配置更简单。

### 其他

- 添加更多的语言接入示例。

## 2.1.10

发布日期: 2024-09-20

### 增强

- 优化了错误消息，对部份错误表述更加清晰。

### 其他

- 为更多平台提供安装包。

## 2.1.9

发布日期: 2024-09-18

### 新功能

- 发布 `dldump` 工具，支持[备份与恢复](../admin/backup-restore.md)。
- INFORMATION_SCHEMA 中实现了 table partition 的虚拟表。

### 增强

- 支持对系统内存使用的限制，以更好的实现背压处理。
- 优化集群间通信。
- 国产化支持，完美适配了`银河麒麟`系统。

### 其他

- 为 rpm 安装包增加 ARM 支持。
- `show tables` 中不再展示 database 信息。
- 为单机版单独制作二进制包，以更好支持受限设备（完全移除集群相关特性）。

## 2.1.8

发布日期: 2024-09-09

### 新功能

- 实现 `Key-Value` 存储模型，协议层完全兼容 Redis 协议，详见[Key-Value](../key-value-data-model/overview.md)。
- 实现 `information_schema` 数据库，以方便对元数据进行管理。

### 增强

- 对配置文件的层级关系进行了优化。
- 对于系统中一些无效的元数据进行快速回收、清理。

### 修复

- 修复 TIMESTAMP 转换可能导致 `panic` 的问题。

## 2.1.7

发布日期: 2024-08-23

### 新功能

- 支持 `trim database` 语句，实现对资源进行加速回收。
- 在集群模式下，对于存储的数据支持混合缓存（内存与磁盘），提升数据查询效率。
- 在本次发版本中，增加了对 ARM 的支持。
- 在 `dlsql` 中，支持通过`\G`对数据进行格式化输出。
- 支持与 EMQX 进行对接，可通过  EMQX 的规则引擎将数据持久化到 Datalayers 中。

### 增强

- 对 HTTP 返回的结构进行调整。
- 优化 InfluxDB 行协议写入。

### 修复

- 在 `dlsql`中，当返回结果为空时的显示问题。
